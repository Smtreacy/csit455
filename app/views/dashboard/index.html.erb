<div class="ajax-cont">

</div> <!-- AJAX Destination -->

<h2>Hello Professor</h2>
<p>Please Select a Class to modify the books required</p>
<!-- Gives the ability to send back information to the user from controller -->
<% flash.each do |message_type, message| %>
    <div class="alert alert-<%= message_type %>"><%= message %></div>
<% end %>

<% if @teacher.admin %>
    <a href="/admin/toggle"><div class="switch-btn">
      <p class="switch-txt">
        Admin View
      </p>
    </div></a>
<% end %>
<% @courses.each do |course| %>
  <div id="container" >
    <button class="dropdown"><%=course.name%></button>
    <div class="panel">
      <table>
        <thead>
          <tr class="top">
            <th class="title">Title:</th>
            <th class="title">Author:</th>
            <th class="title">ISBN:</th>
            <th class="title">Edition:</th>
          </tr>
        </thead>
        <tbody>
          <% course.books.each do |book| %>
            <tr>
              <th><%= book.title %></th>
              <th><%= book.author %></th>
              <th><%= book.isbn %></th>
              <th><%= book.edition %></th>
            </tr>
          <% end %>
        </tbody>
      </table>
      <a href="#" onclick="bookAjax(<%= @teacher.id %>, <%= course.id %>)" class="add-book">
        <div id="add-book-btn">
          <p class="btn-text">Add New Book</p>
        </div>
      </a>
    </div>
  </div>
<% end %>

<!-- JavaScript for accordion drop down -->
<script>
    var acc = document.getElementsByClassName("dropdown");
    var i;

    for (i = 0; i < acc.length; ++i) {
        acc[i].onclick = function() {
            this.classList.toggle("active");
            var panel = this.nextElementSibling;
            if (panel.style.maxHeight){
                panel.style.maxHeight = null;
            } else {
                panel.style.maxHeight = panel.scrollHeight + "px";
            }
        }
    }

    /* AJAX JQuery for adding books form */
    function bookAjax(t_id, c_id) {
        $.ajax(
            {
                url: '/teachers/' + t_id + '/courses/' + c_id + '/books/new',
                cache: false,
                success: function (html) {
                    console.log("Success! T_id: " + t_id + "  C_id: "+c_id);
                    $('.ajax-cont').html(html).css({"display": "block", "z-index": "100"})
                        .animate({"opacity": "1"}, {duration: 350, queue: false});
                }
            }
        );
    }

    $(document).ready(function () {
        $('.ajax-cont').css({'opacity': '0', 'display':'none'});

        $('a.add-book').on("click", (a)=>{a.preventDefault();})
    });

    $(document).ajaxComplete(function() {
        /* Add closing animation */
        $('p.exit').click(function() {
            //hide the container to show login form
            $('.ajax-cont').animate({"opacity": "0"}, {duration: 350, complete: () => {
                $('.ajax-cont').css({"display": "none", "z-index": "-100"});
            }});
        });


    })
</script>
